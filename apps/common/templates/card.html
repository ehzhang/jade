{% extends 'base.html' %}

{% block content %}

<div class="ui grid container" style="margin-top: 20px">
    <div class="two wide column">&nbsp;</div>
    <div class="two wide column">
        <div class="ui icon header">
            <i class="circular question icon"></i>
        </div>
    </div>
    <div class="ten wide column">
        <h1><a href="{% url 'poll_atomic' poll.id %}">{{ poll.name }}</a></h1>
    </div>
</div>

<div class="container">
    <div class="ui piled segment">
        <div class="ui grid">
            <div class="two wide column">
                votes
            </div>
            <div class="fourteen wide column">
                <h1>{{ card.text }}</h1>
                {% if card.submitter %}
                    <p align="right">Posted by {{ card.submitter }}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="container" id="comments">
    {% for comment in card.comments %}
        {% include 'comment.html' %}
    {% endfor %}
</div>

<div class="container">
    <form id="comment" action="{% url 'create_comment' %}"
        method="post">
        {% csrf_token %}
        <div class="ui fluid icon input">
            <input type="text" name="text" placeholder="Add a new comment" id="comment_text">
            <i class="teal pencil icon"></i>
        </div>
        <input type="hidden" name="option_id" value="{{ card.option_id }}">
    </form>
</div>

<script type="text/javascript">
    function redraw(){
        $.get(
            "{% url 'option_redraw' %}",
            {'option_id': {{ card.option_id }}},
            function(result){
                $('#comments')[0].innerHTML = result['comment_html'];
            }
        );
    }
    function reply(){
        $('#comment').submit();
    }

    $('#comment_text').keyup(function(event){
        if (event.which == 13){
            reply();
        }
    });

    $('#comment').submit(function(){
        if ($("#comment_text")[0].value == ''){
            return false;
        }
        $.post(
            $(this).attr('action'),
            $(this).serialize(),
            function(response){
                if (response['result'] == 'success'){
                    $('#comment_text')[0].value = '';
                    redraw();
                }
            }
        );
        return false;
    });

</script>

{% endblock %}

